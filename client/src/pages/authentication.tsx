import { useState } from "react"
import axios from "axios";
import { api } from "../api";
import { useNavigate } from "react-router-dom";
import { useAuth } from "../hooks/authHook";


export default function Authentication () {

    const [isRegistered, setIsRegistered] = useState(false)
    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');
    const [errorMessage, setErrorMessage] = useState('');

    const {login} = useAuth();

    const navigate = useNavigate();

    async function handleAuth() {
            try {
                    const endpoint = isRegistered ? "login" : "register";
                    const response = await api.post(`/auth/${endpoint}`, {
                    username,
                    password,
                    });

                    await login(response.data.token);

                    navigate('/');
            } catch (err) {
                if (axios.isAxiosError(err)) {
                    console.log(err.message);
                    setErrorMessage(err.message)
                } else {
                    console.log("Unexpected error", err);
                    setErrorMessage("Unexpected error")
                }
            }
    }

    return (
        <div className="flex flex-col items-center text-black dark:text-white">
            <h1 className="font-bold text-3xl my-5">{isRegistered ? 'Log In' : 'Sign Up'}</h1>
            <div className="w-full max-w-2xl flex flex-col gap-8">
                <div className="flex flex-col gap-8 w-full max-w-2xl rounded-3xl bg-slate-300 dark:bg-slate-800 p-10">
                    <input
                        type="text"
                        value={username}
                        onChange={(e) => setUsername(e.target.value)}
                        placeholder="Username"
                        className="bg-slate-100 dark:bg-slate-700 rounded-xl border border-black dark:border-slate-500 p-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <input
                        type="password"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        placeholder="Password"
                        className="bg-slate-100 dark:bg-slate-700 rounded-xl border border-black dark:border-slate-500 p-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    {errorMessage ? <p className="text-red-500"> {errorMessage} </p> : <></>}

                </div>

                <button className="bg-blue-300 hover:bg-blue-200 active:bg-blue-100 dark:bg-blue-600 dark:hover:bg-blue-700 dark:active:bg-blue-800 py-3 rounded-xl font-semibold"
                onClick={handleAuth}>
                    {isRegistered ? 'Log In' : 'Sign Up'}
                </button>

                <div className="flex gap-1">
                    <p> {isRegistered ? "don't have an account?" : 'already have an account?'}</p>
                    <button className="cursor-pointer text-blue-400 active:text-blue-100 hover:text-blue-200"
                    onClick={() => setIsRegistered(!isRegistered)}>
                        {isRegistered ? 'Sign Up' : "Log In"}
                    </button>
                </div>

            </div>
        </div>
    )


}